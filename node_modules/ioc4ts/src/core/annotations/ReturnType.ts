/**
 * ReturnType 注解
 * 
 * 定义在类的方法上，用来标识方法的返回类型
 * 
 * @author zhangbaili
 * @since 2021/10/23
*/

import ApplicationContext from '../ApplicationContext'
import MethodDefinition from '../MethodDefinition'

export default function ReturnType(type: string) {
    return (ctor: any, methodName: string) => {
        const beanFactory = ApplicationContext.getInstance().getBeanFactory()
        const beanDefinition = beanFactory.getBeanDefinitionByCtor(ctor)

        if(beanDefinition) {
            let methodDefinition = beanDefinition.getMethods().get(methodName)
            if(!methodDefinition) {
                methodDefinition = new MethodDefinition(methodName)
                methodDefinition.setReturnType(type)
                beanDefinition.appendMethod(methodName, methodDefinition)
            } else {
                methodDefinition.setReturnType(type)
            }
        } else {
            const newBeanDefinition = beanFactory.loadBeanDefinition(ctor)
            const methodDefinition = new MethodDefinition(methodName)

            methodDefinition.setReturnType(type)
            newBeanDefinition.appendMethod(methodName, methodDefinition)
        }
    }
}